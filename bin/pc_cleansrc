#!/bin/sh

# pc_cleansrc
# -----------
# Description:
#   Removes all symbolic links created by 'pc_setupsrc'.
#   Removes all compiled executables and other build objects.
#   Localized source files (see pc_localize) are maintained.
#   Data and other files in the run directory are maintained.

delete_links()
{
  # delete symlinks to scripts
  for file in $links
  do
    # echo "$file"
    if [ -L $file ]; then
      rm -f $file
    fi
  done
}

delete_files()
{
  # delete regular files
  for file in $files
  do
    if [ -f $file ]; then
      rm -f $file
    fi
  done
}

clean_dir()
{
  dir=$1
  # delete object files
  for object in $objects
  do
    for file in $dir/$object
    do
      if [ -f $file ]; then
        rm -f $file
      fi
    done
  done
  # delete symlinks in source directory
  for file in $dir/*
  do
    if [ -L $file ]; then
      rm -f $file
    fi
  done
  # enter sub-directories
  for test in $dir/*
  do
    if [ -d $test ]; then
      clean_dir $test
    fi
  done
  rmdir $dir >/dev/null 2>&1
}

objects="*.o *.a *.mod *.x *.inc .build-history .buildinfo .buildtime"
links="start.csh start_run.csh run.csh getconf.csh Makefile src/.cvsignore"
files=".pc_build_history run_command.log COMPLETED ERROR LOCK STOP FULLSTOP src/Makefile src/revision.txt src/.current-precision"
src_dir="src"

echo "Cleaning up run directory..."
delete_links
delete_files
clean_dir $src_dir
echo "...done."

